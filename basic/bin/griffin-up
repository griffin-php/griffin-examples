#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use Griffin\Event\Migration as MigrationEvent;
use Griffin\Examples\Basic;
use Griffin\Migration\Container;
use Griffin\Planner\Planner;
use Griffin\Runner\Runner;
use League\Event\EventDispatcher;

$container = new Container();
$planner   = new Planner($container);
$runner    = new Runner($planner);

$runner->setEventDispatcher(new EventDispatcher());

$runner->getPlanner()->getContainer()
    // Sort Alphabetically (or Any Order)
    ->addMigration(new Basic\Items())
    ->addMigration(new Basic\Orders())
    ->addMigration(new Basic\Payments())
    ->addMigration(new Basic\Products())
    ->addMigration(new Basic\Users());

$logger = fn($event) => printf("%s::%s\n", $event::class, $event->getMigration()::class);

$runner->getEventDispatcher()
    ->subscribeTo(MigrationEvent\UpBefore::class, $logger);

$runner->getEventDispatcher()
    ->subscribeTo(MigrationEvent\UpAfter::class, $logger);

$runner->up(); // Migrate Up Everything
